<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Messenger</title>
    <style>
      body {
        background: linear-gradient(135deg, #232526 0%, #414345 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Segoe UI", "Roboto", Arial, sans-serif;
      }
      .container {
        background: #18191a;
        padding: 2.5em 2em 2em 2em;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.25);
        width: 100%;
        max-width: 350px;
      }
      h2 {
        color: #fff;
        margin-bottom: 1.2em;
        text-align: center;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 1em;
      }
      input {
        padding: 0.8em 1em;
        border-radius: 6px;
        border: 1px solid #333;
        background: #232526;
        color: #e4e6eb;
        font-size: 1em;
        outline: none;
      }
      input:focus {
        border: 1.5px solid #667eea;
      }
      button {
        background: #667eea;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 0.8em 1em;
        font-size: 1em;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }
      button:hover {
        background: #764ba2;
      }
      .switch {
        text-align: center;
        margin-top: 1em;
      }
      .switch a {
        color: #8ab4f8;
        text-decoration: none;
      }
      .switch a:hover {
        text-decoration: underline;
      }
      .msg {
        text-align: center;
        margin-bottom: 1em;
        font-size: 0.98em;
      }
      .msg.error {
        color: #f44336;
      }
      .msg.success {
        color: #4caf50;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Login</h2>
      <div id="msg" class="msg"></div>
      <form id="loginForm">
        <input
          type="text"
          id="username"
          placeholder="Username or Email"
          required
        />
        <input type="password" id="password" placeholder="Password" required />
        <button type="submit">Login</button>
      </form>
      <div class="switch">
        Don't have an account? <a href="register.html">Register</a>
      </div>
    </div>
    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const msg = document.getElementById("msg");
          msg.textContent = "";
          msg.className = "msg";
          const username = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value;
          const payload = username.includes("@")
            ? { email: username, password }
            : { username, password };
          try {
            const res = await fetch("http://localhost:3000/v1/api/auth/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });
            const data = await res.json();
            if (res.ok) {
              msg.textContent = "Login successful!";
              msg.className = "msg success";
              // Save token to localStorage (optional)
              if (data.token) localStorage.setItem("token", data.token);
              if (data.success)
                localStorage.setItem(
                  "user_data",
                  JSON.stringify(data.data.user)
                );
              setTimeout(() => {
                window.location = "client.html";
              }, 1000);
            } else {
              msg.textContent = data.message || "Login failed.";
              msg.className = "msg error";
            }
          } catch (err) {
            msg.textContent = "Network error.";
            msg.className = "msg error";
          }
        });
    </script>
  </body>
</html>
